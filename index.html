<!DOCTYPE html>
<html>
<body>
<h2>Period tracker sample</h2>
<button onclick="postMessage('get_access_token')">Get Info</button>
<button onclick="postMessage('refresh_access_token')">Refresh Access Token</button>
<p id="demo"></p>
<script>

    function postMessage(operation) {
    try {
       let requestCode = "user_auth."+operation;
        let json = {
           "request_id":"1235",
           "request_body":{
              "request_code" : requestCode,
              "data": {
              }
           },
           "callback":"JSMethodToSendResponse"
        }
        alert("Request : "+JSON.stringify(json));
    } catch(err) {
    	alert("In catch");
    	alert("Error: "+err)
        let x = document.getElementsByTagName("h3")[0];
        x.innerHTML = "error" + err;
    }

    }
 function JSMethodToSendResponse(response) {
 	// document.write(string);
 	// 	alert("response"+JSON.stringify(string));
  //     var x = document.getElementsByTagName("h3")[0];
  //     x.innerHTML = JSON.stringify(string);
  alert("Response : "+JSON.stringify(response));
            try {
                var jsonResponse = null;
                if (typeof response === 'string') {
                    jsonResponse = JSON.parse(response);
                    alert("Response in try: "+response);
                } else {
                    jsonResponse = response;
                    alert("Response in try: "+JSON.stringify(response));
                }

                var profileResponse = {};
                if (jsonResponse && jsonResponse.status && jsonResponse.status.toLowerCase() === 'success') {
                    profileResponse['status'] = jsonResponse.status;
                    var profileData = jsonResponse && jsonResponse.response_body && jsonResponse.response_body.data && jsonResponse.response_body.data.profile || null;
                    if (profileData) {
                        profileResponse['data'] = profileData;
                        userProfile = profileResponse;
                    }
                }
                if (jsonResponse && jsonResponse.status && jsonResponse.status.toLowerCase() === 'failure') {
                    profileResponse['status'] = jsonResponse.status;
                    var errorResponse = jsonResponse && jsonResponse.error || null;
                    if (errorResponse) {
                        profileResponse['error'] = errorResponse;
                        userProfile = null;
                    }
                }
                if (jsonResponse && jsonResponse.request_id && requestHistory[jsonResponse.request_id]) {
                    requestHistory[jsonResponse.request_id](profileResponse);
                }
            } catch (error) {
                userProfile = null;
            }
            alert('userProfileCallback:' + JSON.stringify(profileResponse));
    }

</script>
<h3></h3>
</body>
</html>